<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://img.icons8.com/ios-filled/180/34C759/money-bag.png">
    <title>InverCalc Matrix</title>
    <style>
        :root {
            --ios-bg: #F2F2F7;
            --ios-green: #34C759;
            --ios-red: #FF3B30;
            --ios-card: #FFFFFF;
            --ios-gray: #8E8E93;
        }
        body { font-family: -apple-system, sans-serif; background: var(--ios-bg); margin: 0; padding: 15px; padding-bottom: 180px; }
        .header { margin-top: 30px; text-align: center; }
        h1 { color: var(--ios-green); font-size: 26px; font-weight: 800; margin-bottom: 5px; }
        
        .section { background: var(--ios-card); border-radius: 14px; overflow: hidden; margin-bottom: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .row-input { display: flex; align-items: center; padding: 12px 16px; border-bottom: 0.5px solid #E5E5EA; }
        .row-input:last-child { border-bottom: none; }
        label { width: 120px; font-size: 14px; color: #3a3a3c; font-weight: 600; }
        input { border: none; outline: none; font-size: 17px; width: 100%; color: var(--ios-green); text-align: right; font-weight: 600; background: transparent; }
        
        .button-group { display: flex; gap: 10px; margin-bottom: 25px; }
        button { flex: 1; border: none; border-radius: 12px; padding: 16px; font-size: 16px; font-weight: 700; cursor: pointer; }
        .btn-add { background: var(--ios-green); color: white; }
        .btn-clear { background: #E5E5EA; color: #3a3a3c; }

        .card-inv { background: white; border-radius: 16px; margin-bottom: 15px; padding: 16px; border-left: 5px solid var(--ios-green); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .inv-title { font-size: 14px; font-weight: 700; margin-bottom: 15px; display: flex; justify-content: space-between; border-bottom: 0.5px solid #F2F2F7; padding-bottom: 8px; }
        
        .grid-matrix { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-item { background: #F9F9F9; padding: 10px; border-radius: 10px; border: 0.5px solid #F0F0F0; }
        .grid-item span { display: block; font-size: 9px; color: var(--ios-gray); font-weight: 800; margin-bottom: 2px; }
        .grid-item b { font-size: 13px; color: #1c1c1e; display: block; }
        .grid-item i { font-size: 11px; color: var(--ios-green); font-style: normal; font-weight: 600; }

        .projection-box { background: var(--ios-green); color: white; padding: 14px; border-radius: 12px; margin-top: 15px; display: flex; justify-content: space-between; align-items: center; }
        .proj-text small { font-size: 10px; opacity: 0.9; text-transform: uppercase; display: block; }
        .proj-text b { font-size: 18px; font-weight: 800; }
        .proj-gain { text-align: right; background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 8px; }
        .proj-gain small { font-size: 9px; display: block; }
        .proj-gain b { font-size: 14px; }

        /* Barra de Totales Triple */
        .total-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #1c1c1e; color: white; padding: 15px 20px; border-radius: 20px 20px 0 0; z-index: 100; box-shadow: 0 -5px 15px rgba(0,0,0,0.3); }
        .total-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px; border-bottom: 0.5px solid #333; padding-bottom: 10px; }
        .total-item small { color: var(--ios-gray); font-size: 9px; display: block; text-transform: uppercase; margin-bottom: 2px; }
        .total-item b { font-size: 16px; color: white; }
        .total-main { text-align: center; }
        .total-main small { color: var(--ios-gray); font-size: 10px; display: block; text-transform: uppercase; }
        .total-main b { color: var(--ios-green); font-size: 26px; font-weight: 800; }

        .delete-btn { color: var(--ios-red); font-size: 18px; }
    </style>
</head>
<body>

    <div class="header">
        <h1>InverCalc Matrix</h1>
    </div>

    <div class="section">
        <div class="row-input"><label>Capital Inicial</label><input type="text" id="montoInput" placeholder="0.00" oninput="formatInput(this)"></div>
        <div class="row-input"><label>Tasa Anual %</label><input type="number" id="tasa" placeholder="0.0"></div>
        <div class="row-input"><label>Plazo (Años)</label><input type="number" id="años" value="1"></div>
    </div>

    <div class="button-group">
        <button class="btn-clear" onclick="limpiarCampos()">Limpiar</button>
        <button class="btn-add" onclick="agregarInversion()">+ Agregar Cartera</button>
    </div>

    <div id="listaInversiones"><p style="text-align:center; color:var(--ios-gray); font-style:italic;">No hay inversiones registradas</p></div>

    <div class="total-bar" id="cajaTotales" style="display:none;">
        <div class="total-grid">
            <div class="total-item"><small>Suma Capital Inicial</small><b id="totCapital">$0.00</b></div>
            <div class="total-item" style="text-align: right;"><small>Ganancia Proyectada</small><b id="totGain">$0.00</b></div>
        </div>
        <div class="total-main">
            <small>Valor Final de Cartera</small>
            <b id="totFinal">$0.00</b>
        </div>
    </div>

    <script>
        let inversiones = [];

        function formatInput(el) {
            let value = el.value.replace(/[^0-9.]/g, '');
            if (value) {
                let parts = value.split('.');
                parts[0] = parseInt(parts[0]).toLocaleString('en-US');
                el.value = parts.join('.');
            }
        }

        function comp(P, r, t_dias) {
            const r_diaria = (r / 100) / 365;
            const montoFinal = P * Math.pow((1 + r_diaria), t_dias);
            return { total: montoFinal, gain: montoFinal - P };
        }

        function agregarInversion() {
            const rawMonto = document.getElementById('montoInput').value.replace(/,/g, '');
            const P = parseFloat(rawMonto) || 0;
            const r = parseFloat(document.getElementById('tasa').value) || 0;
            const años = parseFloat(document.getElementById('años').value) || 1;

            if (P > 0 && r > 0) {
                inversiones.push({
                    monto: P, tasa: r, años: años,
                    d1: comp(P, r, 1), d7: comp(P, r, 7), d30: comp(P, r, 30), d365: comp(P, r, 365),
                    final: comp(P, r, años * 365)
                });
                actualizarInterfaz();
                limpiarCampos();
            }
        }

        function eliminarInversion(index) {
            inversiones.splice(index, 1);
            actualizarInterfaz();
        }

        function actualizarInterfaz() {
            const contenedor = document.getElementById('listaInversiones');
            const cajaTotales = document.getElementById('cajaTotales');
            const f = (n) => '$' + n.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});

            if (inversiones.length === 0) {
                contenedor.innerHTML = '<p style="text-align:center; color:var(--ios-gray); font-style:italic;">No hay inversiones registradas</p>';
                cajaTotales.style.display = 'none';
                return;
            }

            cajaTotales.style.display = 'block';
            let sCapital = 0, sGain = 0, sFinal = 0;
            let html = '';

            inversiones.forEach((inv, index) => {
                sCapital += inv.monto;
                sFinal += inv.final.total;
                sGain += inv.final.gain;
                html += `
                <div class="card-inv">
                    <div class="inv-title"><span>CAPITAL: ${f(inv.monto)} (${inv.tasa}%)</span><span class="delete-btn" onclick="eliminarInversion(${index})">✕</span></div>
                    <div class="grid-matrix">
                        <div class="grid-item"><span>1 DÍA</span><b>${f(inv.d1.total)}</b><i>+${f(inv.d1.gain)}</i></div>
                        <div class="grid-item"><span>7 DÍAS</span><b>${f(inv.d7.total)}</b><i>+${f(inv.d7.gain)}</i></div>
                        <div class="grid-item"><span>30 DÍAS</span><b>${f(inv.d30.total)}</b><i>+${f(inv.d30.gain)}</i></div>
                        <div class="grid-item"><span>1 AÑO</span><b>${f(inv.d365.total)}</b><i>+${f(inv.d365.gain)}</i></div>
                    </div>
                    <div class="projection-box">
                        <div class="proj-text"><small>Total a ${inv.años} años</small><b>${f(inv.final.total)}</b></div>
                        <div class="proj-gain"><small>Ganancia neta</small><b>+${f(inv.final.gain)}</b></div>
                    </div>
                </div>`;
            });

            contenedor.innerHTML = html;
            document.getElementById('totCapital').innerText = f(sCapital);
            document.getElementById('totGain').innerText = f(sGain);
            document.getElementById('totFinal').innerText = f(sFinal);
        }

        function limpiarCampos() {
            document.getElementById('montoInput').value = '';
            document.getElementById('tasa').value = '';
        }
    </script>
</body>
</html>